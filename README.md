# Lwallet Insights

Lwallet Insights — це ванільний (без збірника) застосунок для візуалізації стану крипторинку. Проєкт рендерить два вертикальні полотна (9:16) та горизонтальний макет для Telegram, підтягує дані з CoinMarketCap API через проксі та дозволяє експортувати готові екрани у PNG/JPEG для соціальних мереж.

## Основні можливості
- **Три макети**: `page-1` (огляд ринку), `page-2` (лідери росту/падіння + індекс страху) та `tg` (комбінований лендскейп для Telegram).
- **Живі дані**: `app/data.js` збирає котирування, глобальні метрики, індекс страху/жадібності та формує агрегований `state`.
- **Офлайн-заготовки**: `app/state.js` містить дефолтні значення, тому застосунок виглядає коректно навіть без мережі.
- **Автоскейл полотна**: `app/autoscale.js` підлаштовує масштаб під розмір вікна, не змінюючи реальної роздільності полотна (1080×1920 та 1350×990).
- **Експорт у зображення**: `app/export.js` використовує `html2canvas` для збереження активного або обох макетів у PNG/JPEG з власним масштабом, прозорим фоном та суфіксами назв файлів.
- **Попереднє завантаження зображень**: `app/images.js` прогріває аватарки активів, щоб уникнути розмиття під час експорту.

## Технологічний стек
- HTML5 + CSS (один глобальний файл `assets/styles.css`).
- Чистий ES Modules без збірки (`app/*.js`).
- `html2canvas@1.4.1` з CDN для клієнтського рендера canvas.
- CoinMarketCap REST + Fear & Greed API, проксовані через Cloudflare Worker (`https://lwallet-cmc-proxy.moloshiigpt.workers.dev`).
- Будь-який статичний вебсервер (Node, Python, Caddy тощо) для локальної розробки.

## Структура проєкту
```text
.
├─ index.html            # Точка входу, оголошує навігацію та підключає JS/CSS
├─ assets/
│  └─ styles.css         # Повна стилізація застосунку та полотен
├─ app/
│  ├─ app.js             # Ініціалізація роутера, стану, автоскейлу та кнопок
│  ├─ autoscale.js       # Масштабування полотна під доступний Viewport
│  ├─ api/coinmarketcap.js
│  ├─ components/
│  │  ├─ page1.js        # Огляд ринку
│  │  ├─ page2.js        # Лідери + Індекс страху
│  │  └─ pageCombined.js # Telegram макет
│  ├─ config.js          # Список маршрутів та параметри полотен
│  ├─ data.js            # Fetch + нормалізація даних
│  ├─ export.js          # Експорт у PNG/JPEG
│  ├─ images.js          # Прелоад аватарок
│  ├─ render.js          # Вибір компонента за роутом
│  ├─ router.js          # Хеш-навігація
│  ├─ state.js           # Статичні дані за замовчуванням
│  └─ utils.js           # Утиліти (форматування, escape)
└─ worker/               # (зарезервовано під серверні експерименти)
```

## Швидкий старт
> Репозиторій не має збірки чи залежностей — достатньо статичного сервера, бо браузеру потрібен HTTP для ES-модулів та CORS до API.

1. Встановіть будь-який статичний сервер (приклади нижче).
2. З кореня проєкту запустіть сервер і відкрийте видану адресу в браузері (Chrome/Edge/Firefox).
3. Для коректного імпорту модулів не відкривайте `index.html` напряму через `file://`.

### Варіант 1. Node.js (serve)
```bash
npm install --global serve
serve . --listen 4173
```

### Варіант 2. npx http-server
```bash
npx http-server . -p 4173 -c-1
```

### Варіант 3. Python
```bash
python -m http.server 4173
```

Після старту перейдіть на `http://localhost:4173/` (порт може відрізнятися).

## Оновлення даних
- Натисніть кнопку «Оновити» у хедері або викличте `window.refreshData()` з консолі.
- `app/data.js` паралельно викликає `fetchListings`, `fetchGlobalMetrics` та `fetchFearGreedSnapshot`, після чого формує агрегований обʼєкт із трендами, популярними монетами та індексом страху.
- Дані мерджаться з поточним `state`, тож при часткових збоях зберігаються попередні значення.
- У випадку офлайну застосунок продовжує відображати дефолтні дані з `state.js`.

## Експорт макетів
- Кнопка «Зберегти поточну» (`#save-btn`/`#save-one`) експортує активний маршрут.
- «Зберегти все» послідовно проходить усі `ROUTES` з `app/config.js` і додає суфікс `-page-1`, `-page-2`, `-tg` до назв файлів.
- Налаштування формату, масштабу та прозорості беруться з елементів `#export-format`, `#export-scale`, `#export-transparent` (додайте їх до DOM за потреби).
- Експорт відбувається у фактичній роздільній здатності, визначеній у `PAGE_SPECS` (`w/h` для превʼю та `exportW/exportH` для фінального зображення).

## Налаштування макетів та стилів
- Змінити розміри полотна для кожного роута можна в `app/config.js`.
- Нові сторінки додаються шляхом розширення `ROUTES`, створення компонента у `app/components/` та оновлення `render()`.
- Кольорова тема керується дата-атрибутом `data-theme` на `html`. Кнопка з `id="theme-toggle"` необовʼязкова, але якщо додати її у DOM, перемикання теми працюватиме з коробки.
- Глобальні стилі зосереджені в `assets/styles.css`. Для складних компонентів можна додавати BEM-подібні блоки, головне — не ламати селектори, що використовуються під час експорту.

## Тестування та забезпечення якості
- Автоматизованих тестів поки немає. Основні перевірки — ручні: рендер усіх маршрутів, повторний експорт та перевірка, що зображення з `s2.coinmarketcap.com` не блокує CORS.
- Для стабільності варто тестувати в браузерах Chromium та Gecko, оскільки html2canvas поводиться по-різному.

## Подальші кроки (рекомендації)
1. **Додати середовище `.env` та власний проксі** для CoinMarketCap, щоби зменшити залежність від публічного Worker.
2. **Автоматизувати збірку** (Vite/Parcel) для можливості імпорту типізованих модулів та мінімізації CSS.
3. **Покрити критичні модулі юніт-тестами** (форматування чисел, класифікація Fear & Greed).
4. **Додати PWA-маніфест** і кешування, аби застосунок відкривався офлайн з останніми даними.
5. **Створити lint-правила** (ESLint + Prettier) для контрольованих MR.

---
За потреби можна розширювати README секціями (FAQ, changelog, гайди з верстки), але наведений базис уже описує архітектуру, запуск і ключові сценарії користування.
